fragment AniListMedia on Media {
    id
    description
    title {
        english
        romaji
        native
    }
    type
    isAdult
    coverImage {
        extraLarge
        large
        medium
        color
    }
    synonyms
}

fragment MediaWithListStatus on Media {
    ...MediaNavigationData
    mediaListEntry {
        id
        status
        progressVolumes
        progress
    }
}

fragment MediaPreview on Media {
    ...MediaHeaderData
    ...MediaCompactWithTags
    episodes
    volumes
    chapters
    genres
    source
    tags {
        rank
    }
    startDate {
        year
        month
        day
    }
    externalLinks {
        siteId
    }
}

fragment MediaCompactWithTags on Media {
    ...MediaWithListStatus
    coverImage {
        color
    }
    tags {
        ...GeneralMediaTag
        isMediaSpoiler
    }
    averageScore
    popularity
    format
    season
    seasonYear
    episodes
    chapters
    volumes
    nextAiringEpisode {
        episode
    }
}

fragment MediaCompactWithoutTags on Media {
    ...MediaWithListStatus
    coverImage {
        color
    }
    averageScore
    popularity
    format
    season
    seasonYear
    episodes
    chapters
    volumes
    nextAiringEpisode {
        episode
    }
}

query MediaAdvancedSearch(
    $page: Int,
    $perPage: Int,
    $search: String,
    $type: MediaType!,
    $sort: [MediaSort],
    $genreIn: [String],
    $genreNotIn: [String],
    $tagIn: [String],
    $tagNotIn: [String],
    $statusIn: [MediaStatus],
    $statusNotIn: [MediaStatus],
    $formatIn: [MediaFormat],
    $formatNotIn: [MediaFormat],
    $isAdult: Boolean,
    $onList: Boolean,
    $season: MediaSeason,
    $seasonYear: Int,
    $startDateGreater: FuzzyDateInt,
    $startDateLesser: FuzzyDateInt,
    $averageScoreGreater: Int,
    $averageScoreLesser: Int,
    $episodesGreater: Int,
    $episodesLesser: Int,
    $volumesGreater: Int,
    $volumesLesser: Int,
    $chaptersGreater: Int,
    $chaptersLesser: Int,
    $sourceIn: [MediaSource],
    $minimumTagRank: Int,
    $licensedByIdIn: [Int],
    $includeDescription: Boolean = true,
) {
    Page(page: $page, perPage: $perPage) @nonnull {
        pageInfo @nonnull {
            hasNextPage
            total
        }
        media(
            search: $search,
            type: $type,
            sort: $sort,
            genre_in: $genreIn,
            genre_not_in: $genreNotIn,
            tag_in: $tagIn,
            tag_not_in: $tagNotIn,
            status_in: $statusIn,
            status_not_in: $statusNotIn,
            format_in: $formatIn,
            format_not_in: $formatNotIn,
            isAdult: $isAdult,
            onList: $onList,
            season: $season,
            seasonYear: $seasonYear,
            startDate_greater: $startDateGreater,
            startDate_lesser: $startDateLesser,
            averageScore_greater: $averageScoreGreater,
            averageScore_lesser: $averageScoreLesser,
            episodes_greater: $episodesGreater,
            episodes_lesser: $episodesLesser,
            volumes_greater: $volumesGreater,
            volumes_lesser: $volumesLesser,
            chapters_greater: $chaptersGreater,
            chapters_lesser: $chaptersLesser,
            source_in: $sourceIn,
            minimumTagRank: $minimumTagRank,
            licensedById_in: $licensedByIdIn,
        ) @nonnull {
            ...MediaPreviewWithDescription
        }
    }
}

fragment MediaDetailsListEntry on MediaList {
    id
    mediaId
    status
    score(format: POINT_100)
    progress
    progressVolumes
    repeat
    priority
    private
    notes
    advancedScores
    startedAt {
        year
        month
        day
    }
    completedAt {
        year
        month
        day
    }
    updatedAt
    createdAt
}

fragment MediaNavigationData on Media {
    id
    title {
        ...MediaTitleFragment
    }
    coverImage {
        extraLarge
    }
    type
    isAdult
}

query MediaDetails($mediaId: Int!, $includeDescription: Boolean = true) {
    Media(id: $mediaId) {
        ...MediaHeaderData
        ...MediaPreviewWithDescription
        bannerImage
        coverImage {
            color
            extraLarge
        }
        title {
            ...MediaTitleFragment
        }

        characters(sort: [RELEVANCE, ROLE, FAVOURITES_DESC], page: 1, perPage: 10) {
            pageInfo {
                ...PaginationInfo
            }
            edges {
                ...DetailsCharacterEdge
            }
        }
        isAdult
        averageScore
        meanScore
        countryOfOrigin
        duration
        favourites
        source
        staff(sort: [RELEVANCE, ROLE, FAVOURITES_DESC], page: 1, perPage: 10) {
            pageInfo {
                ...PaginationInfo
            }
            edges {
                role
                node {
                    ...StaffNavigationData
                }
            }
        }
        studios {
            edges {
                isMain
                node {
                    id
                    name
                }
            }
        }
        synonyms
        episodes
        externalLinks {
            id
            type
            url
            icon
            site
            color
        }
        format
        genres
        hashtag
        isLicensed
        mediaListEntry {
            ...MediaDetailsListEntry
        }
        nextAiringEpisode {
            episode
            airingAt
        }
        popularity
        rankings {
            id
            rank
            type
            format
            year
            season
            allTime
            context
        }

        relations {
            pageInfo {
                hasNextPage
            }
            edges {
                id
                relationType
                node {
                    ...MediaPreview
                }
            }
        }

        recommendations(sort: [RATING_DESC], perPage: 5) {
            pageInfo {
                hasNextPage
            }
            edges {
                node {
                    id
                    rating
                    mediaRecommendation {
                        ...MediaPreview
                    }
                }
            }
        }

        # TODO: Handle pagination
        reviews(sort: [RATING_DESC], perPage: 3) {
            pageInfo {
                hasNextPage
            }
            nodes {
                ...MediaAndReviewsReview
            }
        }
        season
        seasonYear
        stats {
            scoreDistribution {
                score
                amount
            }
            statusDistribution {
                status
                amount
            }
        }
        status
        startDate {
            year
            month
            day
        }
        endDate {
            year
            month
            day
        }
        streamingEpisodes {
            title
            thumbnail
            url
            site
        }
        tags {
            ...GeneralMediaTag
            isMediaSpoiler
            rank
        }
        trailer {
            id
            site
            thumbnail
        }
        trending
        type
        volumes
        chapters
    }
}

query MediaDetailsCharactersPage($mediaId: Int!, $page: Int!, $perPage: Int!) {
    Media(id: $mediaId) @nonnull {
        isAdult
        characters(sort: [RELEVANCE, ROLE, FAVOURITES_DESC], page: $page, perPage: $perPage) @nonnull {
            pageInfo @nonnull {
                ...PaginationInfo
            }
            edges @nonnull {
                ...DetailsCharacterEdge
            }
        }
    }
}

query MediaDetailsStaffPage($mediaId: Int!, $page: Int!, $perPage: Int!) {
    Media(id: $mediaId) @nonnull {
        isAdult
        staff(sort: [RELEVANCE, ROLE, FAVOURITES_DESC], page: $page, perPage: $perPage) @nonnull {
            pageInfo @nonnull {
                ...PaginationInfo
            }
            edges @nonnull{
                role
                node @nonnull {
                    ...StaffNavigationData
                }
            }
        }
    }
}

query MediaTitlesAndImages($ids: [Int]) {
    Page {
        media(id_in: $ids) {
            ...MediaNavigationData
        }
    }
}

query MediaByIds($ids: [Int]) {
    Page {
        media(id_in: $ids) {
            ...MediaPreview
            title {
                romaji
                native
                english
            }
            synonyms
        }
    }
}

query MediaSearch($search: String, $perPage: Int, $page: Int) {
    Page(perPage: $perPage, page: $page) @nonnull {
        media(search: $search) @nonnull {
            ...AniListMedia
        }
    }
}

query SimpleMediaByIds($ids: [Int]) {
    Page(page: 1, perPage: 25) {
        media(id_in: $ids) {
            ...AniListMedia
        }
    }
}

query MediaWithCharacters($mediaId: Int, $page: Int, $perPage: Int) {
    Media(id: $mediaId) @nonnull {
        isAdult
        characters(page: $page, perPage: $perPage, sort: [RELEVANCE, ROLE]) @nonnull {
            nodes @nonnull {
                id
            }
        }
    }
}

fragment MediaPreviewWithDescription on Media {
    ...MediaPreview
    description(asHtml: true) @include(if: $includeDescription)
}

query HomeAnime(
    $currentSeason: MediaSeason!,
    $currentYear: Int!,
    $lastSeason: MediaSeason!,
    $lastYear: Int!,
    $nextSeason: MediaSeason!,
    $nextYear: Int!,
    $perPage: Int!,
    $includeDescription: Boolean = true,
) {
    trending: Page(perPage: $perPage) {
        media(sort: TRENDING_DESC, type: ANIME, isAdult: false) {
            ...MediaPreviewWithDescription
        }
    }

    popularThisSeason: Page(perPage: $perPage) {
        media(
            season: $currentSeason,
            seasonYear: $currentYear,
            sort: POPULARITY_DESC,
            type: ANIME,
            isAdult: false,
        ) {
            ...MediaPreviewWithDescription
        }
    }

    lastAdded: Page(perPage: $perPage) {
        media(
            sort: ID_DESC,
            type: ANIME,
            isAdult: false,
        ) {
            ...MediaPreviewWithDescription
        }
    }

    popularLastSeason: Page(perPage: $perPage) {
        media(
            season: $lastSeason,
            seasonYear: $lastYear,
            sort: POPULARITY_DESC,
            type: ANIME,
            isAdult: false,
        ) {
            ...MediaPreviewWithDescription
        }
    }

    popularNextSeason: Page(perPage: $perPage) {
        media(
            season: $nextSeason,
            seasonYear: $nextYear,
            sort: POPULARITY_DESC,
            type: ANIME,
            isAdult: false,
        ) {
            ...MediaPreviewWithDescription
        }
    }
}

query HomeAnime2(
    $perPage: Int!,
    $includeDescription: Boolean = true,
) {
    popular: Page(perPage: $perPage) {
        media(sort: POPULARITY_DESC, type: ANIME, isAdult: false) {
            ...MediaPreviewWithDescription
        }
    }

    top: Page(perPage: $perPage) {
        media(sort: SCORE_DESC, type: ANIME, isAdult: false) {
            ...MediaPreviewWithDescription
        }
    }
}

query HomeManga($perPage: Int!, $includeDescription: Boolean = true) {
    trending: Page(perPage: $perPage) {
        media(sort: TRENDING_DESC, type: MANGA, isAdult: false) {
            ...MediaPreviewWithDescription
        }
    }

    lastAdded: Page(perPage: $perPage) {
        media(sort: ID_DESC, type: MANGA, isAdult: false) {
            ...MediaPreviewWithDescription
        }
    }
}

query HomeManga2($perPage: Int!, $includeDescription: Boolean = true) {
    popular: Page(perPage: $perPage) {
        media(sort: POPULARITY_DESC, type: MANGA, isAdult: false) {
            ...MediaPreviewWithDescription
        }
    }

    top: Page(perPage: $perPage) {
        media(sort: SCORE_DESC, type: MANGA, isAdult: false) {
            ...MediaPreviewWithDescription
        }
    }
}

query AiringSchedule(
    $startTime: Int!,
    $endTime: Int!,
    $perPage: Int!,
    $page: Int!,
    $sort: [AiringSort!]!,
) {
    Page(perPage: $perPage, page: $page) {
        pageInfo {
            ...PaginationInfo
        }
        airingSchedules(
            airingAt_greater: $startTime,
            airingAt_lesser: $endTime,
            sort: $sort,
        ) {
            id
            airingAt
            episode
            media {
                ...MediaPreview
            }
        }
    }
}

fragment MediaHeaderData on Media {
    ...MediaNavigationData
    bannerImage
    coverImage {
        color
    }
    format
    status
    season
    seasonYear
    averageScore
    popularity
    nextAiringEpisode {
        episode
        airingAt
    }
    isFavourite
}

fragment MediaAndReviewsReview on Review {
    id
    user {
        ...UserNavigationData
    }
    rating
    ratingAmount
    score
    summary
    updatedAt
}

query MediaAndReviews(
    $mediaId: Int!,
    $sort: [ReviewSort]!,
    $reviewsPerPage: Int!,
) {
    Media(id: $mediaId) @nonnull {
        ...MediaHeaderData
        reviews(sort: $sort, page: 1, perPage: $reviewsPerPage) {
            pageInfo @nonnull {
                ...PaginationInfo
            }
            nodes {
                ...MediaAndReviewsReview
            }
        }
    }
}

query MediaAndReviewsPagination(
    $mediaId: Int!,
    $sort: [ReviewSort]!,
    $page: Int!,
    $reviewsPerPage: Int!,
) {
    Media(id: $mediaId) @nonnull {
        isAdult
        reviews(sort: $sort, page: $page, perPage: $reviewsPerPage) {
            pageInfo @nonnull {
                ...PaginationInfo
            }
            nodes {
                ...MediaAndReviewsReview
            }
        }
    }
}

fragment MediaAndRecommendationsRecommendation on Recommendation {
    id
    user {
        ...UserNavigationData
    }
    rating
    mediaRecommendation {
        ...MediaPreview
    }
}

query MediaAndRecommendations(
    $mediaId: Int!,
    $sort: [RecommendationSort]!,
    $recommendationsPerPage: Int!,
) {
    Media(id: $mediaId) @nonnull {
        ...MediaHeaderData
        recommendations(sort: $sort, page: 1, perPage: $recommendationsPerPage) {
            pageInfo @nonnull {
                ...PaginationInfo
            }
            nodes {
                ...MediaAndRecommendationsRecommendation
            }
        }
    }
}

query MediaAndRecommendationsPagination(
    $mediaId: Int!,
    $sort: [RecommendationSort]!,
    $page: Int!,
    $recommendationsPerPage: Int!,
) {
    Media(id: $mediaId) @nonnull {
        isAdult
        recommendations(sort: $sort, page: $page, perPage: $recommendationsPerPage) {
            pageInfo @nonnull {
                ...PaginationInfo
            }
            nodes {
                ...MediaAndRecommendationsRecommendation
            }
        }
    }
}

query MediaListEntry($id: Int!) {
    Media(id: $id) @nonnull {
        isAdult
        type
        episodes
        volumes
        chapters
        status
        nextAiringEpisode {
            episode
        }
        mediaListEntry {
            ...MediaDetailsListEntry
        }
    }
}


fragment MediaListActivityItem on ActivityUnion {
    ... on ListActivity {
        ...ListActivityWithoutMedia
    }
}

query MediaActivity($mediaId: Int!, $sort: [ActivitySort]!, $activitiesPerPage: Int!) {
    Media(id: $mediaId) @nonnull {
        ...MediaHeaderData
    }

    Page(page: 1, perPage: $activitiesPerPage) @nonnull {
        pageInfo @nonnull {
            ...PaginationInfo
        }
        activities(mediaId: $mediaId, sort: $sort) @nonnull {
            ...MediaListActivityItem
        }
    }
}

query MediaActivityPage($mediaId: Int!, $sort: [ActivitySort]!, $page: Int!, $activitiesPerPage: Int!) {
    Page(page: $page, perPage: $activitiesPerPage) @nonnull {
        pageInfo @nonnull {
            ...PaginationInfo
        }
        activities(mediaId: $mediaId, sort: $sort) @nonnull {
            ...MediaListActivityItem
        }
    }
}

fragment MediaTitleFragment on MediaTitle {
    userPreferred
    romaji
    english
    native
}
