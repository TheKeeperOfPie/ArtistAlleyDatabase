fragment AniListCharacterName on CharacterName {
    first
    middle
    last
    full
    native
    alternative
}

fragment AniListCharacter on Character {
    id
    name {
        ...AniListCharacterName
    }
    image {
        large
        medium
    }

    media(page: $mediaPage, perPage: $mediaPerPage) {
        nodes {
            ...AniListMedia
        }
        edges {
            id
            voiceActors {
                id
                languageV2
                name {
                    ...AniListStaffName
                }
                image {
                    large
                    medium
                }
            }
            node {
                id
            }
        }
    }
}


query CharacterAdvancedSearch(
    $page: Int,
    $perPage: Int,
    $search: String,
    $isBirthday: Boolean,
    $sort: [CharacterSort],
) {
    Page(page: $page, perPage: $perPage) @nonnull {
        pageInfo @nonnull {
            hasNextPage
            total
        }
        characters(search: $search, isBirthday: $isBirthday, sort: $sort) {
            ...CharacterNavigationData
            favourites

            media(sort: [TRENDING_DESC, POPULARITY_DESC, FAVOURITES_DESC], perPage: 5) {
                edges {
                    id
                    voiceActors {
                        ...StaffNavigationData
                        languageV2
                    }
                    node {
                        ...MediaNavigationData
                    }
                }
            }
        }
    }
}

fragment DetailsCharacterEdge on CharacterEdge {
    voiceActors {
        ...StaffNavigationData
        languageV2
        name {
            full
            alternative
        }
    }
    node @nonnull {
        ...CharacterNavigationData
        name {
            full
            alternative
        }
    }
}

fragment CharacterNavigationData on Character {
    id
    name {
        userPreferred
    }
    image {
        large
    }
}

fragment CharacterHeaderData on Character {
    ...CharacterNavigationData
    id
    name {
        full
        alternative
        alternativeSpoiler
        native
        userPreferred
    }
    image {
        large
    }
    isFavourite
}

query CharacterDetails($id: Int!) {
    Character(id: $id) {
        ...CharacterHeaderData
        description(asHtml: true)
        age
        dateOfBirth {
            year
            month
            day
        }
        gender
        bloodType
        favourites

        # TODO: Pagination
        media(sort: [POPULARITY_DESC], perPage: 5) {
            pageInfo {
                hasNextPage
            }
            edges {
                characterName
                characterRole
                voiceActorRoles {
                    voiceActor {
                        ...StaffNavigationData
                        name {
                            full
                        }
                        languageV2
                        favourites
                    }

                    # TODO: roleNotes, dubGroup?
                    # roleNotes
                    # dubGroup
                }

                node {
                    ...MediaPreview
                }
            }
        }

        # TODO: Favorite
    }
}

query CharactersSearch($search: String, $perPage: Int, $page: Int, $mediaPage: Int,
    $mediaPerPage: Int) {
    Page(perPage: $perPage, page: $page) @nonnull {
        characters(search: $search) @nonnull {
            ...AniListCharacter
        }
    }
}

query CharactersByIds($ids: [Int], $mediaPage: Int, $mediaPerPage: Int) {
    Page(page: 1, perPage: 25) {
        characters(id_in: $ids) {
            ...AniListCharacter
        }
    }
}

fragment CharacterWithRole on CharacterEdge {
    ...DetailsCharacterEdge
    role
}

fragment CharacterWithRoleAndFavorites on CharacterEdge {
    ...DetailsCharacterEdge
    node {
        media(sort: [FAVOURITES_DESC]) {
            nodes {
                ...MediaNavigationData
            }
        }
        favourites
    }
    role
}

query MediaAndCharacters($mediaId: Int!, $charactersPerPage: Int!) {
    Media(id: $mediaId) @nonnull {
        ...MediaHeaderData
        characters(sort: [RELEVANCE, ROLE, FAVOURITES_DESC], page: 1, perPage: $charactersPerPage) {
            pageInfo @nonnull {
                ...PaginationInfo
            }
            edges {
                ...CharacterWithRole
            }
        }
    }
}

query MediaAndCharactersPagination($mediaId: Int!, $page: Int!, $charactersPerPage: Int!) {
    Media(id: $mediaId) @nonnull {
        isAdult
        characters(sort: [RELEVANCE, ROLE, FAVOURITES_DESC], page: $page, perPage: $charactersPerPage) {
            pageInfo @nonnull {
                ...PaginationInfo
            }
            edges {
                ...CharacterWithRole
            }
        }
    }
}

query CharacterAndMedias(
    $characterId: Int!,
    $sort: [MediaSort]!,
    $mediasPerPage: Int!,
) {
    Character(id: $characterId) @nonnull {
        ...CharacterHeaderData

        media(sort: $sort, page: 1, perPage: $mediasPerPage) {
            pageInfo @nonnull {
                ...PaginationInfo
            }
            nodes {
                ...MediaPreview
            }
        }
    }
}

query CharacterAndMediasPagination(
    $characterId: Int!,
    $sort: [MediaSort]!,
    $page: Int!,
    $mediasPerPage: Int!,
) {
    Character(id: $characterId) @nonnull {
        media(sort: $sort, page: $page, perPage: $mediasPerPage) {
            pageInfo @nonnull {
                ...PaginationInfo
            }
            nodes {
                ...MediaPreview
            }
        }
    }
}
